var SV=SV||{};!function(a,b,c,d){SV.WarningViewToggler=function(a){this.__construct(a)},SV.WarningViewToggler.prototype={__construct:function(b){this.$toggler=b,this.$selectView=b.siblings(b.data("selectview")),this.$radioView=b.siblings(b.data("radioview")),this.phrases={toggleSelect:b.data("toggleselecttext"),toggleRadio:b.data("toggleradiotext")},this.storageName="xf_sv_warningview",this.setting=localStorage.getItem(this.storageName),this.init(),b.on("click",a.context(this,"eClick"))},init:function(){this.setting&&this.setting.length||this.setSetting("select"),"select"==this.setting?(this.$selectView.show(),this.$radioView.remove(),this.$toggler.text(this.phrases.toggleRadio)):(this.$selectView.remove(),this.$toggler.text(this.phrases.toggleSelect))},toggle:function(){"select"==this.setting?this.setSetting("radio"):this.setSetting("select"),b.location.reload()},setSetting:function(a){this.setting=a,localStorage.setItem(this.storageName,this.setting)},eClick:function(a){a.preventDefault(),this.toggle()}},SV.WarningSelector=function(a){this.__construct(a)},SV.WarningSelector.prototype={__construct:function(b){this.$selector=b,this.$customWarningTitle=b.siblings(b.data("customwarningtitle")),this.phrases={noresults:b.data("noresultstext"),placeholder:b.data("placeholdertext")},this.init(),b.on("change",a.context(this,"eChange"))},init:function(){this.$selector.chosen({width:"100%",inherit_select_classes:!0,no_result_text:this.phrases.noresults,placeholder_text_single:this.phrases.placeholder})},eChange:function(b){var c=a(b.target).val();this.$selector.find('option[value="'+c+'"]').trigger("click"),0==c?(this.$customWarningTitle.show(),setTimeout(a.context(function(){this.$customWarningTitle.focus()},this),100)):this.$customWarningTitle.hide()}},SV.WarningItemTree=function(a){this.__construct(a)},SV.WarningItemTree.prototype={__construct:function(b){this.$tree=b,this.overlay=b.data("overlay"),this.$searchInput=a(b.data("searchinput")),this.urls={load:b.data("loadurl"),sync:b.data("syncurl"),rename:b.data("renameurl"),categoryEdit:b.data("categoryediturl"),categoryDelete:b.data("categorydeleteurl"),warningEdit:b.data("warningediturl"),warningDelete:b.data("warningdeleteurl")},this.phrases={rename:b.data("renametext"),edit:b.data("edittext"),delete:b.data("deletetext")},this.init(),this.initSearch(),b.on("ready.jstree",a.context(this,"eReady")),b.on("move_node.jstree",a.context(this,"eMoveNode")),b.on("rename_node.jstree",a.context(this,"eRenameNode"))},init:function(){XenForo.ajax(this.urls.load,"",a.context(function(c){this.$tree.jstree({plugins:["contextmenu","dnd","search","types","wholerow"],core:{data:c.tree,check_callback:function(a,b,c){if("rename_node"==a){var d=b.id.substr(1);return 0!=d}return"move_node"==a&&("category"!=b.type||"#"==c.parent||null==c.parent)},multiple:!1},contextmenu:{items:{rename:{label:this.phrases.rename,_disabled:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference),e=d.id.substr(1);return 0==e},action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.edit(d)}},edit:{label:this.phrases.edit,action:a.context(function(c){var g,d=a.jstree.reference(c.reference),e=d.get_node(c.reference),f=e.id.substr(1);"category"==e.type?g=this.urls.categoryEdit.replace("{id}",f):"definition"==e.type&&(g=this.urls.warningEdit.replace("{id}",f)),b.location=XenForo.canonicalizeUrl(g)},this)},delete:{label:this.phrases.delete,_disabled:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference),e=d.id.substr(1);return 0==e},action:a.context(function(b){var f,c=a.jstree.reference(b.reference),d=c.get_node(b.reference),e=d.id.substr(1);"category"==d.type?f=this.urls.categoryDelete.replace("{id}",e):"definition"==d.type&&(f=this.urls.warningDelete.replace("{id}",e));var g=new XenForo.OverlayLoader(a({href:f}),!1,{speed:XenForo.speed.fast});g.load()},this)}}},dnd:{copy:!1,is_draggable:!0,touch:"selected",large_drop_target:!0,large_drag_target:!0},search:{show_only_matches:!0},state:{key:"xf_sv_warningitemtree"},types:{"#":{max_depth:3,valid_children:["category"]},category:{max_depth:2,valid_children:["category","definition"]},definition:{icon:"jstree-file",max_depth:0,valid_children:[]}}})},this))},initSearch:function(){var b=!1;this.$searchInput.keyup(a.context(function(){b&&clearTimeout(b),b=setTimeout(a.context(function(){var a=this.$searchInput.val();this.$tree.jstree(!0).search(a)},this),250)},this))},sync:function(){var a={tree:this.$tree.jstree(!0).get_json("#",{flat:!0})};XenForo.ajax(this.urls.sync,a,function(){console.log("Tree synchronized")})},handleLast:function(){if(b.location.hash){var c,a=b.location.hash.replace("#_","");0==a.indexOf("warning-")?c=a.replace("warning-","d"):0==a.indexOf("category-")&&(c=a.replace("category-","c")),c&&this.$tree.jstree(!0).select_node(c)}},eReady:function(){this.sync(),this.overlay&&(this.$tree.find(".jstree-anchor").addClass("OverlayTrigger"),this.$tree.xfActivate()),null===localStorage.getItem("xf_sv_warningitemtree")&&this.$tree.jstree(!0).open_all(),this.handleLast()},eMoveNode:function(){this.sync()},eRenameNode:function(a,b){var c={node:b.node};XenForo.ajax(this.urls.rename,c,function(){console.log("Node renamed")})}},XenForo.register("a.WarningViewToggler","SV.WarningViewToggler"),XenForo.register("select.WarningSelector","SV.WarningSelector"),XenForo.register(".WarningItemTree","SV.WarningItemTree")}(jQuery,this,document);
